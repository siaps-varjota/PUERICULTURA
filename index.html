<<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUERICULTURA</title>
    <style>
        /* Seu CSS original aqui (sem alterações) */
        body { font-family: Arial, sans-serif; margin: 0px; background-color: #f4f4f9; }
        h1 { text-align: center; color: #333; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; padding: 12px; background-color: #fff; box-sizing: border-box; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        th, td { padding: 12px; text-align: left; border: 1px solid #ddd; }
        th:nth-child(n+5), td:nth-child(n+5) { text-align: center; }
        td.editable { cursor: pointer; position: relative; }
        td.editable:hover { background-color: #e0f7fa; }
        td.editable input[type="date"] { width: 100%; padding: 8px; border: none; outline: none; font-size: 16px; box-sizing: border-box; }
        th { background-color: #4CAF50; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        tr:hover { background-color: #ddd; }
        @media screen and (max-width: 600px) { table { display: block; overflow-x: auto; } }
        #loader { text-align: center; padding: 20px; font-size: 1.2em; }
    </style>
</head>
<body>
    <h1>PUERICULTURA</h1>
    <table id="data-table">
        <thead>
            <tr>
                <th>NOME COMPLETO</th> <th>D.N</th> <th>IDADE</th> <th>SEXO</th> <th>ACS</th>
                <th>VISITA NEO-NATAL</th> <th>1 MÊS</th> <th>2 MESES</th> <th>3 MESES</th>
                <th>4 MESES</th> <th>6 MESES</th> <th>9 MESES</th> <th>12 MESES</th>
                <th>18 MESES</th> <th>24 MESES</th> <th>3 ANOS</th> <th>EM DIA</th>
            </tr>
        </thead>
        <tbody id="table-body">
            <!-- Dados serão inseridos aqui via JavaScript -->
        </tbody>
    </table>
    <div id="loader">Carregando dados da planilha...</div>

    <script>
        // --- Todo o seu script principal para carregar e salvar dados fica aqui ---
        function toISODate(dateString) { if (!dateString || typeof dateString !== 'string') return ''; const parts = dateString.split('/'); if (parts.length === 3) { let [day, month, year] = parts; if (year.length === 2) year = '20' + year; return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`; } return dateString; }
        function toLocaleDate(isoDate) { if (!isoDate) return ''; const date = new Date(isoDate + 'T00:00:00'); const day = String(date.getDate()).padStart(2, '0'); const month = String(date.getMonth() + 1).padStart(2, '0'); const year = String(date.getFullYear()).slice(-2); return `${day}/${month}/${year}`; }
        function loadData() { document.getElementById('loader').style.display = 'block'; google.script.run.withSuccessHandler(populateTable).withFailureHandler(onFailure).getData(); }
        function onFailure(error) { document.getElementById('loader').textContent = 'Erro ao carregar dados: ' + error.message; alert('Erro: ' + error.message); }
        function populateTable(data) { if (data.error) { onFailure(data); return; } const tableBody = document.getElementById('table-body'); tableBody.innerHTML = ''; data.forEach((row, rowIndex) => { if (!row[0]) return; const tr = document.createElement('tr'); tr.setAttribute('data-row-index', rowIndex); row.forEach((cellData, colIndex) => { const td = document.createElement('td'); td.textContent = cellData; td.setAttribute('data-col-index', colIndex); if (colIndex >= 5 && colIndex <= 15) { td.classList.add('editable'); td.addEventListener('click', makeCellEditable); } tr.appendChild(td); }); tableBody.appendChild(tr); }); document.getElementById('loader').style.display = 'none'; }
        function makeCellEditable() { if (this.querySelector('input')) return; const originalValue = this.textContent; const isoDate = toISODate(originalValue); this.innerHTML = ''; const input = document.createElement('input'); input.type = 'date'; input.value = isoDate; input.addEventListener('blur', () => saveCellData(this, input.value, originalValue)); input.addEventListener('keydown', (e) => { if (e.key === 'Enter') input.blur(); if (e.key === 'Escape') { this.innerHTML = originalValue; } }); this.appendChild(input); input.focus(); }
        function saveCellData(cell, newISOValue, originalText) { const rowIndex = parseInt(cell.parentElement.getAttribute('data-row-index')); const colIndex = parseInt(cell.getAttribute('data-col-index')); const newDisplayText = newISOValue ? toLocaleDate(newISOValue) : ''; if (newDisplayText === originalText) { cell.innerHTML = originalText; return; } cell.innerHTML = newDisplayText; console.log(`Salvando... Linha: ${rowIndex}, Coluna: ${colIndex}, Valor: ${newDisplayText}`); google.script.run.withSuccessHandler(response => console.log(response.message)).withFailureHandler(onFailure).updateData(rowIndex, colIndex, newDisplayText); }
        window.onload = loadData;
    </script>

    <!-- SOLUÇÃO DEFINITIVA PARA REMOVER O BANNER DO GOOGLE -->
    <script>
      const observer = new MutationObserver((mutationsList, observer) => {
        // Itera sobre todas as mutações que ocorreram
        for (const mutation of mutationsList) {
          if (mutation.type === 'childList') {
            // Itera sobre todos os nós (elementos) que foram adicionados
            for (const node of mutation.addedNodes) {
              // Verifica se o nó é um elemento HTML (e não texto, por exemplo)
              if (node.nodeType === 1) { 
                // Verifica se o elemento adicionado corresponde às características do banner
                if (node.style.position === 'fixed' && node.style.top === '0px') {
                  console.log('Banner do Google detectado e removido.');
                  node.style.display = 'none';
                  // Uma vez removido, podemos parar de observar para economizar recursos.
                  observer.disconnect();
                  return;
                }
              }
            }
          }
        }
      });

      // Inicia a observação no corpo do documento (<body>)
      // 'childList: true' observa a adição e remoção de elementos filhos
      // 'subtree: true' estende a observação para todos os descendentes do <body>
      observer.observe(document.body, { childList: true, subtree: true });
    </script>

</body>
</html>
